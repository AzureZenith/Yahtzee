<!doctype html>
<html>
    <head>
        <meta charset="UTF-8">
        <title></title>
        <style>
            *{
                font-family: monospace;
                font-size: 24px;
                box-sizing: border-box;
            }
            /* Create two equal columns that floats next to each other */
            .column
            {
                float: left;
                width: 50%;
                padding: 10px;
            }
            /* Clear floats after the columns */
            .row:after
            {
                content: "";
                display: table;
                clear: both;
            }
        </style>
    </head>

    <body onload="load()">
        <script>
            //This script focuses on handling the dice.
            //scripts for handling scoring are placed closer to the scorecard.

            //These are objects, for user interactions.
            const dice=[0,0,0,0,0];
            //vals stores numerical values for scoring, but nothing else.
            //It can also be reorganized for calculations.
            const vals=[0,0,0,0,0];
            var rollsRemaining=3;
            function load()
            {
                //alert("loading...");
                document.getElementById("roll_button").setAttribute("onclick","rollAll()");
                for(var i=0;i<5;i++)
                {
                    //setting up the dice[i]...
                    dice[i]=new Object();
                    dice[i].value=0;
                    dice[i].lockedIn=false;
                    dice[i].toString=function()
                    {
                        var result ="";
                        if(this.lockedIn)
                        {
                            result+=String.fromCharCode(8194)+String.fromCharCode(8194);
                        }
                        if(this.value>=1 && this.value<=6)
                        {
                            result+= String.fromCharCode(9855+this.value);
                        }
                        else
                        {
                            result+= "-";
                        }
                        if(!this.lockedIn)
                        {
                            result+=String.fromCharCode(8194)+String.fromCharCode(8194);
                        }
                        return result;
                    };
                    dice[i].roll=function()
                    {
                        if(! this.lockedIn)
                        {
                            this.value=1+Math.floor(Math.random() * 6);
                        }
                        //Randomize lockedIn to test rendering.
                        //this.lockedIn=(Math.random()<0.5);
                    };
                    dice[i].toggle=function()
                    {
                        if(this.lockedIn)
                        {this.lockedIn=false;}
                        else
                        {this.lockedIn=true;}
                    };
                    //setting up corresponding element in HTML doc...
                    document.getElementById("dice").children[2*i].index=i;
                    //alert("updated index for die" + i + " to " + document.getElementById("dice").children[2*i].index);
                    document.getElementById("dice").children[2*i].onclick
                        =function(){dice[this.index].toggle();render();};
                    //alert("updated onclick for die" + i);
                }
                //I made more than 5 attempts to do this with a loop.
                //At which point, it's easier to do all five cases.
                /*document.getElementById("dice").children[0].onclick = function()
                {dice[0].toggle();render();};
                document.getElementById("dice").children[2].onclick = function()
                {dice[1].toggle();render();};
                document.getElementById("dice").children[4].onclick = function()
                {dice[2].toggle();render();};
                document.getElementById("dice").children[6].onclick = function()
                {dice[3].toggle();render();};
                document.getElementById("dice").children[8].onclick = function()
                {dice[4].toggle();render();};*/

                //After loading dice manager, load scorecard manager.
                //alert("Dice manager loaded successfully.");
                loadScorecard();
                render();
            }
            function render()
            {
                document.getElementById("sorted").innerHTML="Rolls remaining: "+rollsRemaining;
                document.getElementById("straight").innerHTML
                    ="┏━━━┓<br>"
                    +"┃"+alignRight(sum(vals),3)+"┃<br>"
                    +"┗━━━┛<br>";
                for(var i=0;i<5;i++)
                {
                    document.getElementById("dice").children[i*2].innerHTML=dice[i].toString();
                }
                if(rollsRemaining<=0 || dice.every(checkLock))
                {
                    document.getElementById("roll_button").disabled=true;
                }
                else
                {
                    document.getElementById("roll_button").disabled=false;
                }
            }
            function rollAll()
            {
                if(rollsRemaining>0)
                {
                    for(var i=0;i<5;i++)
                    {
                        dice[i].roll();
                        vals[i]=dice[i].value;
                    }
                    vals.sort();
                    rollsRemaining--;
                    render();
                }
            }
            function checkLock(die){return die.lockedIn;}
            function isSmallStraight(input) {
            
                input.sort((a,b)=>a-b);
                for(var i=0;i<5;i++)
                {
                    document.getElementById("sorted").innerHTML+=String.fromCharCode(9855+input[i]);
                }
                const straights = ["1234", "2345", "3456"];
                const diceString = input.join("");
                return straights.some(straight => diceString.includes(straight));
            }
        </script>
        <div class="column">
            <div id="dice">
                <!-- I really wanted to automate the instanciation of these elements,
                    but it kept messing up all kinds of other parts of the script.
                    Eventually I gave up. Hardcoding 5 paragraph elements is way easier -->
                <button id="die0"></button><br>
                <button id="die1"></button><br>
                <button id="die2"></button><br>
                <button id="die3"></button><br>
                <button id="die4"></button>
            </div>
            <button id="roll_button">
                Roll dice
            </button>
            <p id="sorted">
            </p>
            <p id="straight">
            </p>
        </div>
        <script>
            function loadScorecard()
            {
                //alert("loading scorecard...");
                var ones=document.getElementById("ones");
                ones.eligible=false;
                ones.score=-1;
                //alert("in loadScoreCard, nothing calculated yet.");
                /*ones.prospectiveScore=sumWhere(vals,function(num){
                    alert("in anonymous function being passed to sumWhere.")
                    num=1;
                    });
                alert("in loadScoreCard, prospectiveScore initialized to "+ones.prospectiveScore);*/
                ones.onmouseenter=function()
                {
                    if(ones.prospectiveScore!=0)
                    {
                        ones.innerHTML=alignRight(ones.prospectiveScore,3);
                    }
                };
                ones.onmouseleave=function()
                {
                    ones.innerHTML=alignRight(ones.score,3);
                };
            }
            function sum(arr)
            {
                //alert("in sum function.");
                var result=0;
                arr.forEach(num => {
                    result += num;
                });
                return result;
            }
            /*function sumWhere(arr, match);
            {
                alert("in sumWhere function.");
                var result=0;
                arr.forEach(num => {
                    if(num==match)
                    {
                        result += num;
                    }
                });
                return result;
            }*/
            function alignRight(num,width)
            {
                //alert("in alignment function.");
                var result="";
                var digits=1;
                if(num>0)
                {
                    digits=1+Math.floor(Math.log10(num));
                }
                for(var i=0;i<width-digits;i++)
                {
                    result+="&nbsp;";
                }
                if(num>=0)
                {
                    result+=num;
                }
                else
                {
                    result="&nbsp;-&nbsp;";
                }
                return result;
            }
        </script>
        <div class="column">
            ┏━━━━━━┳━━━┓<br>
            ┃ Ones ┃<span id="ones">&nbsp;&nbsp;&nbsp;</span>┃<br>
            ┣━━━━━━╋━━━┫<br>
            ┃ Twos ┃<span id="twos">&nbsp;&nbsp;&nbsp;</span>┃<br>
            ┣━━━━━━╋━━━┫<br>
            ┃Threes┃<span id="threes">&nbsp;&nbsp;&nbsp;</span>┃<br>
            ┣━━━━━━╋━━━┫<br>
            ┃Fours ┃<span id="fours">&nbsp;&nbsp;&nbsp;</span>┃<br>
            ┣━━━━━━╋━━━┫<br>
            ┃Fives ┃<span id="fives">&nbsp;&nbsp;&nbsp;</span>┃<br>
            ┣━━━━━━╋━━━┫<br>
            ┃Sixes ┃<span id="sixes">&nbsp;&nbsp;&nbsp;</span>┃<br>
            ┗━━━━━━┻━━━┛
        </div>
    </body>
</html>
